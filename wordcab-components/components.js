function wordcab(e){const t=this;function r(t,r){if(e.debug)switch(r){case"info":return console.info(t);case"error":return console.error(t);default:return console.log(t)}}function a(e){return e?new Date(1e3*e).toISOString().substr(14,5):"00:00"}function n(e,t,r){return e>=t&&e<=r}function s(e,t){if(!e)return;const r=e.getBoundingClientRect();e.style.height=`calc(100vh - ${r.top+t}px`}function i(a,n){r(`Summary length: ${a.target.value}`,"info"),settings.summaryLength=a.target.value,settings.rangePercent=a.target.value/a.target.max,settings.rangeOffset=settings.rangePercent<.5?e.rangeHandleWidth*(1-settings.rangePercent):e.rangeHandleWidth*-settings.rangePercent,r("Updating summary markup","info"),settings.rangeWidth=`--range-width: calc(${100*settings.rangePercent}% + ${settings.rangeOffset}px);`,t.rangeSlider.parentElement.setAttribute("style",settings.rangeWidth),r("Removing event listeners from summary bullets","info"),document.querySelectorAll(e.summaryBullets).forEach(e=>{e.removeEventListener("click",m,!1)}),t.summaryBlock.innerHTML=l(settings.summaryLength),r("Adding event listeners to summary bullets","info"),document.querySelectorAll(e.summaryBullets).forEach(e=>{e.addEventListener("click",m)}),s(t.transcriptBlock,e.fixedHeightOffset),o()}function l(t){let r="";return t=t||e.defaultLength,e.summaryData.summary[Object.keys(e.summaryData.summary)[t]].structured_summary.forEach(e=>{r+=`\n        <li class="summary-bullet" wordcab-ts-start="${e.timestamp_start}" wordcab-ts-end="${e.timestamp_end}">\n          ${e.summary}\n        </li>`}),r}function o(){r("Updating timestamps","info");const e=document.querySelectorAll("[wordcab-ts-start]");settings.timeStamps=[],e.forEach(e=>{settings.timeStamps.push({start:parseInt(e.getAttribute("wordcab-ts-start")),end:parseInt(e.getAttribute("wordcab-ts-end")),target:e})})}function c(e){r("Highlighting transcript","info"),document.querySelectorAll("[wordcab-ts-start]").forEach(e=>e.classList.remove("active"));const t=settings.timeStamps.filter(t=>(r(`Selected time:${e.start} -> ${e.end} | Item time: ${t.start} -> ${t.end}`,"info"),e.bullet?n(t.start,e.start,e.end)&&n(t.end,e.start,e.end):n(e.start,t.start,t.end)&&n(e.end,t.start,t.end)));t.length&&t.forEach(e=>e.target.classList.add("active"))}function u(){const e=document.querySelector(".transcript-utterance.active"),r=document.querySelector(".summary-bullet.active");e&&(t.transcriptBlock.scrollTop=e.offsetTop),r&&(t.summaryBlock.scrollTop=r.offsetTop)}function m(e){let t=e.target;t.classList.contains("summary-bullet")||t.classList.contains("transcript-utterance")||(t=t.parentElement.classList.contains("transcript-utterance")?t.parentElement:t.closest(".summary-bullet"));const a=t.classList.contains("summary-bullet"),n=parseInt(t.getAttribute("wordcab-ts-start")),s=parseInt(t.getAttribute("wordcab-ts-end"));r(`Summary bullet selected: ${n} -> ${s}`,"info"),c({start:n,end:s,bullet:a}),u(),d(parseInt(n/1e3),!0)}function d(e,r){t.player.currentTime=e,t.player.dispatchEvent(new Event("timestamp")),r||c({start:1e3*e,end:1e3*e})}function p(e){t.player.currentTime===t.player.duration&&(r("Player ended"),settings.player.playing=!1,t.player.currentTime=0),settings.player.playing?(r("Player stopped","info"),settings.player.playing=!1,t.playerBtnIcon.setAttribute("href","#wordcab-play"),t.player.pause()):(r("Player playing","info"),settings.player.playing=!0,t.playerBtnIcon.setAttribute("href","#wordcab-pause"),setTimeout(()=>{t.player.play()},1))}function y(e){var r,n;settings.player.timestamp=Math.floor(e.timeStamp),settings.player.time=t.player.currentTime,t.playerTime.textContent=a(t.player.currentTime),t.playerDuration.textContent=a(t.player.duration),settings.player.duration=t.player.duration,settings.player.percent=(r=settings.player.time,n=settings.player.duration,Math.round(r/n*100)),t.playerProgress.style.width=settings.player.percent+"%"}function g(e){var t;d((t=e.target.value,Math.abs(settings.player.duration*(t/100)))),u()}function b(a){a.player?(r("Player component found","info"),t.playerEl=document.querySelector(e.playerEl),t.playerEl.getAttribute("wordcab-theme")||t.playerEl.setAttribute("wordcab-theme","default"),t.playerEl.innerHTML=settings.templates.player,t.player=t.playerEl.querySelector("[wordcab-audio-player]"),t.playerBtn=t.playerEl.querySelector("[wordcab-player-btn]"),t.playerBtnIcon=t.playerBtn.querySelector("svg use"),t.playerTime=t.playerEl.querySelector("[wordcab-player-time]"),t.playerDuration=t.playerEl.querySelector("[wordcab-player-duration]"),t.playerProgress=t.playerEl.querySelector("[wordcab-player-progress]"),t.playerScrubber=t.playerEl.querySelector("[wordcab-player-scrubber]"),f.player()):r("Could not find player in DOM","error"),a.summary?(r("Summary component found","info"),t.summaryEl=document.querySelector(e.summaryEl),t.summaryEl.getAttribute("wordcab-theme")||t.summaryEl.setAttribute("wordcab-theme","default"),t.summaryEl.innerHTML=settings.templates.summary,t.summaryLengthText=document.querySelector(e.readTime),t.rangeEl=document.querySelector(e.rangeEl),t.rangeProgress=t.rangeEl.querySelector(e.rangeProgress),t.rangeSlider=t.rangeEl.querySelector(e.rangeSlider),t.rangeTicks=t.rangeEl.querySelector(".range-ticks"),t.summaryBlock=t.summaryEl.querySelector(e.summaryBlock),t.summaryBlock.innerHTML=l(),f.summary()):r("Could not find summary element in DOM","error"),a.transcript?(r("Transcript component found","info"),t.transcriptEl=document.querySelector(e.transcriptEl),t.transcriptEl.getAttribute("wordcab-theme")||t.transcriptEl.setAttribute("wordcab-theme","default"),t.transcriptEl.innerHTML=settings.templates.transcript,t.transcriptBlock=t.transcriptEl.querySelector(e.transcriptBlock),t.transcriptBlock.innerHTML=function(){let t="";return e.transcriptData.transcript.forEach(r=>{const a=`speaker_${r.speaker.toLowerCase()}`,n=e.transcriptData.speaker_map[r.speaker];t+=`\n        <div class="transcript-utterance" wordcab-ts-start="${r.timestamp_start}" wordcab-ts-end="${r.timestamp_end}">\n          <span class="transcript-utterance__ts">[${r.start} ${e.timestampSeparator} ${r.end}]</span>\n          <strong class="${a}">${n}</strong>:\n          <span class="transcript-utterance__text">${r.text}</span>\n        </div>`}),t}(),f.transcript()):r("Could not find transcript element in DOM","error")}e={...{audioPath:"",debug:!1,defaultLength:0,fixedHeightOffset:30,maxLength:4,playerEl:"[wordcab-player]",rangeEl:"[wordcab-summary-slider]",rangeHandleWidth:8,rangeProgress:"[wordcab-range-progress]",rangeSlider:"[wordcab-summary-length]",readTime:"[wordcab-read-time]",summaryBlock:"[wordcab-summary-block]",summaryBullets:".summary-bullet",summaryData:null,summaryEl:"[wordcab-summary]",theme:"wordcab",timestampSeparator:"->",transcriptBlock:"[wordcab-transcript-block]",transcriptData:null,transcriptEl:"[wordcab-transcript]",transcriptUtterance:".transcript-utterance",volume:1},...e},settings={player:{playing:!1,time:0},rangeOffset:0,rangePercent:0,rangeWidth:0,summaryLength:0,summaryLengthNum:0,timeStamps:[],templates:{player:`\n        <svg width="0" height="0" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n          <symbol class="sprite" id="wordcab-pause"><rect x="5" y="4" width="5" height="16" fill="currentColor"></rect><rect x="14" y="4" width="5" height="16" fill="currentColor"></rect></symbol>\n          <symbol class="sprite" id="wordcab-play"><path d="M8 19L19 12L8 5V19Z" fill="currentColor"></path></symbol>\n        </svg>\n        <audio wordcab-audio-player id="summaryPlayer" src="${e.audioPath}" autoload>\n          <source src="" type="audio/mpeg">\n          <p>Your browser does not support <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/audio#browser_compatibility">HTML5 audio</a>. Here is a <a href="./sample.mp3">link to the audio</a> instead.</p>\n        </audio>\n        <button wordcab-player-btn>\n          <svg width="24" height="24" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <use href="#wordcab-play"/>\n          </svg>\n        </button>\n        <div wordcab-player-time>00:00</div>\n        <div wordcab-player-timeline>\n          <div wordcab-player-progress style="width:0%;"></div>\n          <svg  width="212" height="41" viewbox="0 0 212 41" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path fill-rule="evenodd" clip-rule="evenodd" d="M212 0H0V41H212V0ZM9 4C9 2.34315 7.65685 1 6 1C4.34315 1 3 2.34315 3 4V37C3 38.6569 4.34315 40 6 40C7.65685 40 9 38.6569 9 37V4ZM16 1C17.6569 1 19 2.34315 19 4V37C19 38.6569 17.6569 40 16 40C14.3431 40 13 38.6569 13 37V4C13 2.34315 14.3431 1 16 1ZM29 10C29 8.34315 27.6569 7 26 7C24.3431 7 23 8.34315 23 10V31C23 32.6569 24.3431 34 26 34C27.6569 34 29 32.6569 29 31V10ZM36 1C37.6569 1 39 2.34315 39 4V37C39 38.6569 37.6569 40 36 40C34.3431 40 33 38.6569 33 37V4C33 2.34315 34.3431 1 36 1ZM49 4C49 2.34315 47.6569 1 46 1C44.3431 1 43 2.34315 43 4V37C43 38.6569 44.3431 40 46 40C47.6569 40 49 38.6569 49 37V4ZM56 6.5C57.6569 6.5 59 7.84315 59 9.5V31.5C59 33.1569 57.6569 34.5 56 34.5C54.3431 34.5 53 33.1569 53 31.5V9.5C53 7.84315 54.3431 6.5 56 6.5ZM69 12C69 10.3431 67.6569 9 66 9C64.3431 9 63 10.3431 63 12V29C63 30.6569 64.3431 32 66 32C67.6569 32 69 30.6569 69 29V12ZM76 12C77.6569 12 79 13.3431 79 15V26C79 27.6569 77.6569 29 76 29C74.3431 29 73 27.6569 73 26V15C73 13.3431 74.3431 12 76 12ZM89 14C89 12.3431 87.6569 11 86 11C84.3431 11 83 12.3431 83 14V27C83 28.6569 84.3431 30 86 30C87.6569 30 89 28.6569 89 27V14ZM96 6.5C97.6569 6.5 99 7.84315 99 9.5V31.5C99 33.1569 97.6569 34.5 96 34.5C94.3431 34.5 93 33.1569 93 31.5V9.5C93 7.84315 94.3431 6.5 96 6.5ZM109 14C109 12.3431 107.657 11 106 11C104.343 11 103 12.3431 103 14V27C103 28.6569 104.343 30 106 30C107.657 30 109 28.6569 109 27V14ZM116 11C117.657 11 119 12.3431 119 14V27C119 28.6569 117.657 30 116 30C114.343 30 113 28.6569 113 27V14C113 12.3431 114.343 11 116 11ZM129 15C129 13.3431 127.657 12 126 12C124.343 12 123 13.3431 123 15V26C123 27.6569 124.343 29 126 29C127.657 29 129 27.6569 129 26V15ZM136 11C137.657 11 139 12.3431 139 14V27C139 28.6569 137.657 30 136 30C134.343 30 133 28.6569 133 27V14C133 12.3431 134.343 11 136 11ZM149 4C149 2.34315 147.657 1 146 1C144.343 1 143 2.34315 143 4V37C143 38.6569 144.343 40 146 40C147.657 40 149 38.6569 149 37V4ZM156 1C157.657 1 159 2.34315 159 4V37C159 38.6569 157.657 40 156 40C154.343 40 153 38.6569 153 37V4C153 2.34315 154.343 1 156 1ZM169 10C169 8.34315 167.657 7 166 7C164.343 7 163 8.34315 163 10V31C163 32.6569 164.343 34 166 34C167.657 34 169 32.6569 169 31V10ZM176 12C177.657 12 179 13.3431 179 15V26C179 27.6569 177.657 29 176 29C174.343 29 173 27.6569 173 26V15C173 13.3431 174.343 12 176 12ZM189 4C189 2.34315 187.657 1 186 1C184.343 1 183 2.34315 183 4V37C183 38.6569 184.343 40 186 40C187.657 40 189 38.6569 189 37V4ZM196 12C197.657 12 199 13.3431 199 15V26C199 27.6569 197.657 29 196 29C194.343 29 193 27.6569 193 26V15C193 13.3431 194.343 12 196 12ZM209 14C209 12.3431 207.657 11 206 11C204.343 11 203 12.3431 203 14V27C203 28.6569 204.343 30 206 30C207.657 30 209 28.6569 209 27V14Z" fill="white"/>\n          </svg>\n          <input wordcab-player-scrubber type="range" value="0" />\n        </div>\n        <div wordcab-player-duration>00:00</div>`,summary:'\n        <div wordcab-summary-slider>\n          <div><b>Shorter</b></div>\n          <div>\n            <div wordcab-range-progress data-range="1" style="--range-width: 0%;">\n              <input wordcab-summary-length type="range">\n              <div class="range-ticks"></div>\n            </div>\n          </div>\n          <div><b>Longer</b></div>\n        </div>\n        <div wordcab-summary-block></div>',transcript:"<div wordcab-transcript-block></div>"}};const f={player:function(){r("Setting up player","info"),t.player.oncanplay=(()=>{settings.player={duration:t.player.duration,...settings.player},t.playerScrubber.addEventListener("change",g),t.player.addEventListener("ended",()=>{r("Player stopped becaseu it reached the end","info"),t.playerBtnIcon.setAttribute("href","#wordcab-play")}),t.player.addEventListener("timeupdate",y),t.playerBtn.addEventListener("click",p),y({timeStamp:1})}),r("Done setting up player","info")},summary:function(){r("Setting up summary","info"),settings.summaryLengthNum=Object.keys(e.summaryData.summary).length,settings.summaryLengthNum<=1?t.rangeEl.remove():(t.rangeSlider.addEventListener("input",e=>{i(e,e.target)}),e.maxLength=settings.summaryLengthNum-1,t.rangeProgress.dataset.range=settings.summaryLengthNum,t.rangeSlider.value=e.defaultLength,t.rangeSlider.setAttribute("max",e.maxLength),t.rangeSlider.dispatchEvent(new Event("input")),function(e){let r="";for(let t=0;t<e;t++)r+='<div class="range-tick"></div>';t.rangeTicks.innerHTML=r}(settings.summaryLengthNum-2)),settings.summaryLength=e.defaultLength,s(t.summaryBlock,e.fixedHeightOffset),document.querySelectorAll(e.summaryBullets).forEach(e=>{e.addEventListener("click",m)}),window.addEventListener("resize",()=>{s(t.summaryBlock,e.fixedHeightOffset)})},transcript:function(){r("Setting up transcript","info"),document.querySelectorAll(e.transcriptUtterance).forEach(e=>{e.addEventListener("click",m)}),s(t.transcriptBlock,e.fixedHeightOffset),window.addEventListener("resize",()=>{s(t.transcriptBlock,e.fixedHeightOffset)})}};r("Initializing Wordcab components","info"),b({player:!!document.querySelector(e.playerEl),summary:!!document.querySelector(e.summaryEl),transcript:!!document.querySelector(e.transcriptEl)}),o()}
